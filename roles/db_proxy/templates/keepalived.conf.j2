vrrp_script chk_proxysql {
    script       "killall -0 proxysql"
    interval 2   # check every 2 seconds
    weight -20   # reduce priority by 20 if failed
    fall 2       # require 2 failures for KO
    rise 2       # require 2 successes for OK
}

# External VIP (Service Side)
vrrp_instance VI_1 {
    state {{ keepalived_state }}
    interface {{ keepalived_vip_interface }}
    virtual_router_id 51
    priority {{ keepalived_priority }}
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        {{ keepalived_vip }}
    }
    track_script {
        chk_proxysql
    }
}

# Internal VIP (Backend Side)
vrrp_instance VI_2 {
    state {{ keepalived_state }}
    interface {{ keepalived_internal_vip_interface }}
    virtual_router_id 52
    priority {{ keepalived_priority }}
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 2222
    }
    virtual_ipaddress {
        {{ keepalived_internal_vip }}/{{ keepalived_internal_vip_cidr }}
    }
    track_script {
        chk_proxysql
    }
}
