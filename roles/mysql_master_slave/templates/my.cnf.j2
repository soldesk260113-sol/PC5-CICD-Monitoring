# MySQL Configuration for Master-Slave Replication
# Generated by Ansible

[mysqld]
# Basic Settings
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid

# Character Set
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci

# Networking
bind-address=0.0.0.0
port=3306

# Replication Settings
{% if mysql_role == 'master' %}
# Master Configuration
server-id={{ mysql_server_id | default(1) }}
log-bin=mysql-bin
binlog-format=ROW
expire_logs_days=7
max_binlog_size=100M

{% elif mysql_role == 'slave' %}
# Slave Configuration
server-id={{ mysql_server_id | default(2) }}
relay-log=mysql-relay-bin
log-bin=mysql-bin
binlog-format=ROW
read_only=1

{% elif mysql_role == 'backup' %}
# Backup Configuration
server-id={{ mysql_server_id | default(3) }}
relay-log=mysql-relay-bin
log-bin=mysql-bin
binlog-format=ROW
read_only=1

{% elif mysql_role == 'dr' %}
# DR Configuration (Standalone - On Demand Pull)
server-id={{ mysql_server_id | default(42) }}
# log-bin, relay-log removed for standalone mode
# read_only removed so it can be written to manually (restore)

{% endif %}

# Performance Tuning
max_connections=200
innodb_buffer_pool_size=256M
innodb_log_file_size=64M
innodb_flush_log_at_trx_commit=1
sync_binlog=1

# Security
skip-name-resolve

[mysql]
default-character-set=utf8mb4

[client]
default-character-set=utf8mb4
socket=/var/lib/mysql/mysql.sock
